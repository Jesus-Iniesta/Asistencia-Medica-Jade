<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/resources/webapp/api.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/webapp/api.js" />
              <option name="originalContent" value="// ========== COMUNICACIÓN CON API ==========&#10;import { CONFIG } from './config.js';&#10;&#10;export async function enviarCita(pacienteData) {&#10;    const response = await fetch(`${CONFIG.API_URL}/cita`, {&#10;        method: 'POST',&#10;        headers: { 'Content-Type': 'application/json' },&#10;        body: JSON.stringify({&#10;            nombre: pacienteData.nombre,&#10;            pacienteId: pacienteData.pacienteId,&#10;            sintomas: pacienteData.sintomas&#10;        })&#10;    });&#10;    return await response.json();&#10;}&#10;&#10;export async function obtenerDiagnostico(pacienteId) {&#10;    const response = await fetch(`${CONFIG.API_URL}/diagnostico/${pacienteId}`);&#10;    return await response.json();&#10;}&#10;&#10;export async function pollingDiagnostico(pacienteId, onSuccess, onError) {&#10;    let attempts = 0;&#10;    const { MAX_ATTEMPTS, INTERVAL_MS } = CONFIG.POLLING;&#10;&#10;    return new Promise((resolve, reject) =&gt; {&#10;        const interval = setInterval(async () =&gt; {&#10;            attempts++;&#10;&#10;            try {&#10;                const data = await obtenerDiagnostico(pacienteId);&#10;                console.log(`Intento ${attempts}:`, data);&#10;&#10;                if (data.pacienteId &amp;&amp; data.diagnostico &amp;&amp; &#10;                    data.diagnostico !== &quot;En proceso...&quot; &amp;&amp; &#10;                    data.diagnostico !== null) {&#10;                    &#10;                    clearInterval(interval);&#10;                    onSuccess(data);&#10;                    resolve(data);&#10;                    &#10;                } else if (attempts &gt;= MAX_ATTEMPTS) {&#10;                    clearInterval(interval);&#10;                    onError('Tiempo de espera agotado');&#10;                    reject(new Error('Timeout'));&#10;                }&#10;            } catch (error) {&#10;                console.error('Error polling:', error);&#10;                if (attempts &gt;= MAX_ATTEMPTS) {&#10;                    clearInterval(interval);&#10;                    onError('Error al obtener diagnóstico');&#10;                    reject(error);&#10;                }&#10;            }&#10;        }, INTERVAL_MS);&#10;    });&#10;}&#10;&#10;" />
              <option name="updatedContent" value="// ========== COMUNICACIÓN CON API ==========&#10;import { CONFIG } from './config.js';&#10;&#10;export async function enviarCita(pacienteData) {&#10;    try {&#10;        console.log(' Enviando cita a:', CONFIG.API_URL);&#10;        const response = await fetch(`${CONFIG.API_URL}/cita`, {&#10;            method: 'POST',&#10;            headers: { 'Content-Type': 'application/json' },&#10;            body: JSON.stringify({&#10;                nombre: pacienteData.nombre,&#10;                pacienteId: pacienteData.pacienteId,&#10;                sintomas: pacienteData.sintomas&#10;            })&#10;        });&#10;        &#10;        if (!response.ok) {&#10;            throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);&#10;        }&#10;        &#10;        const data = await response.json();&#10;        console.log('✅ Respuesta recibida:', data);&#10;        return data;&#10;    } catch (error) {&#10;        console.error('❌ Error al enviar cita:', error);&#10;        throw new Error(`No se pudo conectar con el servidor. Verifica que el servidor esté ejecutándose en ${CONFIG.API_URL}`);&#10;    }&#10;}&#10;&#10;export async function obtenerDiagnostico(pacienteId) {&#10;    try {&#10;        const response = await fetch(`${CONFIG.API_URL}/diagnostico/${pacienteId}`);&#10;        &#10;        if (!response.ok) {&#10;            throw new Error(`Error HTTP: ${response.status}`);&#10;        }&#10;        &#10;        return await response.json();&#10;    } catch (error) {&#10;        console.error('❌ Error al obtener diagnóstico:', error);&#10;        throw error;&#10;    }&#10;}&#10;&#10;export async function pollingDiagnostico(pacienteId, onSuccess, onError) {&#10;    let attempts = 0;&#10;    const { MAX_ATTEMPTS, INTERVAL_MS } = CONFIG.POLLING;&#10;&#10;    return new Promise((resolve, reject) =&gt; {&#10;        const interval = setInterval(async () =&gt; {&#10;            attempts++;&#10;&#10;            try {&#10;                const data = await obtenerDiagnostico(pacienteId);&#10;                console.log(`Intento ${attempts}/${MAX_ATTEMPTS}:`, data);&#10;&#10;                if (data.pacienteId &amp;&amp; data.diagnostico &amp;&amp; &#10;                    data.diagnostico !== &quot;En proceso...&quot; &amp;&amp; &#10;                    data.diagnostico !== null) {&#10;                    &#10;                    clearInterval(interval);&#10;                    onSuccess(data);&#10;                    resolve(data);&#10;                    &#10;                } else if (attempts &gt;= MAX_ATTEMPTS) {&#10;                    clearInterval(interval);&#10;                    onError('Tiempo de espera agotado. Por favor, verifica la conexión con el servidor.');&#10;                    reject(new Error('Timeout'));&#10;                }&#10;            } catch (error) {&#10;                console.error('Error polling:', error);&#10;                if (attempts &gt;= MAX_ATTEMPTS) {&#10;                    clearInterval(interval);&#10;                    onError('Error de conexión con el servidor. Verifica que el servidor JADE esté activo.');&#10;                    reject(error);&#10;                }&#10;            }&#10;        }, INTERVAL_MS);&#10;    });&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/webapp/app.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/webapp/app.js" />
              <option name="originalContent" value="// ========== APLICACIÓN PRINCIPAL ==========&#10;import { METODOS_PAGO } from './config.js';&#10;import { state, resetState, setPacienteData } from './data.js';&#10;import { generarIDUnico } from './utils.js';&#10;import { showStep, resetFormularioCobro } from './ui.js';&#10;import { procesarSignosVitales, procesarCita, procesarPago } from './steps.js';&#10;import { generarRecetaMedica } from './receta.js';&#10;&#10;// ========== INICIALIZACIÓN ==========&#10;document.addEventListener('DOMContentLoaded', () =&gt; {&#10;    inicializarEventos();&#10;});&#10;&#10;function inicializarEventos() {&#10;    // Botón inicial&#10;    document.getElementById('btnPasarRecepcion').addEventListener('click', () =&gt; {&#10;        showStep('recepcion');&#10;    });&#10;&#10;    // Formulario de recepción&#10;    document.getElementById('recepcionForm').addEventListener('submit', manejarRegistroPaciente);&#10;&#10;    // Proceder al cobro&#10;    document.getElementById('btnProcederCobro').addEventListener('click', () =&gt; {&#10;        showStep('cobro');&#10;        document.getElementById('cobro-nombre').textContent = state.currentPacienteData.nombre;&#10;    });&#10;&#10;    // Botones de pago&#10;    document.querySelectorAll('.btn-pago').forEach(btn =&gt; {&#10;        btn.addEventListener('click', function() {&#10;            const metodo = this.getAttribute('data-metodo');&#10;            procesarPago(metodo, METODOS_PAGO);&#10;        });&#10;    });&#10;&#10;    // Ver receta médica&#10;    document.getElementById('btnVerReceta').addEventListener('click', () =&gt; {&#10;        generarRecetaMedica();&#10;        showStep('receta');&#10;    });&#10;&#10;    // Imprimir receta&#10;    document.getElementById('btnImprimirReceta').addEventListener('click', () =&gt; {&#10;        window.print();&#10;    });&#10;&#10;    // Nueva consulta&#10;    document.getElementById('btnNuevaConsulta').addEventListener('click', reiniciarAplicacion);&#10;    document.getElementById('btnVolverInicio').addEventListener('click', reiniciarAplicacion);&#10;}&#10;&#10;// ========== MANEJADORES DE EVENTOS ==========&#10;async function manejarRegistroPaciente(e) {&#10;    e.preventDefault();&#10;&#10;    const pacienteData = {&#10;        nombre: document.getElementById('nombre').value,&#10;        edad: document.getElementById('edad').value,&#10;        genero: document.getElementById('genero').value,&#10;        sintomas: document.getElementById('sintomas').value,&#10;        pacienteId: generarIDUnico()&#10;    };&#10;&#10;    setPacienteData(pacienteData);&#10;&#10;    showStep('enfermero');&#10;    await procesarSignosVitales();&#10;    await procesarCita();&#10;}&#10;&#10;function reiniciarAplicacion() {&#10;    resetState();&#10;    document.getElementById('recepcionForm').reset();&#10;    resetFormularioCobro();&#10;    showStep('inicio');&#10;}&#10;&#10;" />
              <option name="updatedContent" value="// ========== APLICACIÓN PRINCIPAL ==========&#10;import { METODOS_PAGO } from './config.js';&#10;import { state, resetState, setPacienteData } from './data.js';&#10;import { generarIDUnico } from './utils.js';&#10;import { showStep, resetFormularioCobro } from './ui.js';&#10;import { procesarSignosVitales, procesarCita, procesarPago } from './steps.js';&#10;import { generarRecetaMedica } from './receta.js';&#10;&#10;// ========== INICIALIZACIÓN ==========&#10;document.addEventListener('DOMContentLoaded', () =&gt; {&#10;    inicializarEventos();&#10;});&#10;&#10;function inicializarEventos() {&#10;    // Botón inicial&#10;    document.getElementById('btnPasarRecepcion').addEventListener('click', () =&gt; {&#10;        showStep('recepcion');&#10;    });&#10;&#10;    // Formulario de recepción&#10;    document.getElementById('recepcionForm').addEventListener('submit', manejarRegistroPaciente);&#10;&#10;    // Proceder al cobro&#10;    document.getElementById('btnProcederCobro').addEventListener('click', () =&gt; {&#10;        showStep('cobro');&#10;        document.getElementById('cobro-nombre').textContent = state.currentPacienteData.nombre;&#10;    });&#10;&#10;    // Botones de pago&#10;    document.querySelectorAll('.btn-pago').forEach(btn =&gt; {&#10;        btn.addEventListener('click', function() {&#10;            const metodo = this.getAttribute('data-metodo');&#10;            procesarPago(metodo, METODOS_PAGO);&#10;        });&#10;    });&#10;&#10;    // Ver receta médica&#10;    document.getElementById('btnVerReceta').addEventListener('click', () =&gt; {&#10;        generarRecetaMedica();&#10;        showStep('receta');&#10;    });&#10;&#10;    // Imprimir receta&#10;    document.getElementById('btnImprimirReceta').addEventListener('click', () =&gt; {&#10;        window.print();&#10;    });&#10;&#10;    // Nueva consulta&#10;    document.getElementById('btnNuevaConsulta').addEventListener('click', reiniciarAplicacion);&#10;    document.getElementById('btnVolverInicio').addEventListener('click', reiniciarAplicacion);&#10;}&#10;&#10;// ========== MANEJADORES DE EVENTOS ==========&#10;async function manejarRegistroPaciente(e) {&#10;    e.preventDefault();&#10;&#10;    const pacienteData = {&#10;        nombre: document.getElementById('nombre').value,&#10;        edad: document.getElementById('edad').value,&#10;        genero: document.getElementById('genero').value,&#10;        sintomas: document.getElementById('sintomas').value,&#10;        pacienteId: generarIDUnico()&#10;    };&#10;&#10;    setPacienteData(pacienteData);&#10;&#10;    try {&#10;        showStep('enfermero');&#10;        await procesarSignosVitales();&#10;        await procesarCita();&#10;    } catch (error) {&#10;        console.error('❌ Error en el proceso:', error);&#10;        &#10;        // Mostrar mensaje de error al usuario&#10;        alert(`⚠️ Error en el proceso:\n\n${error.message}\n\nAsegúrate de que:\n1. El servidor está ejecutándose\n2. Estás conectado a la misma red\n3. El firewall permite la conexión`);&#10;        &#10;        // Volver al inicio&#10;        showStep('inicio');&#10;    }&#10;}&#10;&#10;function reiniciarAplicacion() {&#10;    resetState();&#10;    document.getElementById('recepcionForm').reset();&#10;    resetFormularioCobro();&#10;    showStep('inicio');&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/webapp/config.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/webapp/config.js" />
              <option name="originalContent" value="// ========== CONFIGURACIÓN ==========&#10;export const CONFIG = {&#10;    API_URL: 'http://localhost:7070/api',&#10;    POLLING: {&#10;        MAX_ATTEMPTS: 20,&#10;        INTERVAL_MS: 2000&#10;    },&#10;    ANIMATION: {&#10;        TYPING_SPEED_MS: 30,&#10;        DELAY_MS: 500&#10;    },&#10;    SIGNOS_VITALES: {&#10;        TEMPERATURA: { min: 35.5, max: 38.0 },&#10;        ALTURA: { min: 150, max: 190 },&#10;        RITMO: { min: 60, max: 100 },&#10;        PRESION_SYS: { min: 110, max: 130 },&#10;        PRESION_DIA: { min: 70, max: 90 }&#10;    }&#10;};&#10;&#10;export const ICONS = {&#10;    recepcion: '',&#10;    enfermero: '',&#10;    doctor: '‍⚕️',&#10;    completado: '✅',&#10;    error: '❌'&#10;};&#10;&#10;export const STEP_TITLES = {&#10;    recepcion: 'En Recepción',&#10;    enfermero: 'Con Enfermero',&#10;    doctor: 'Consulta Médica',&#10;    completado: 'Consulta Completada',&#10;    error: 'Error en el Proceso'&#10;};&#10;&#10;export const METODOS_PAGO = {&#10;    efectivo: ' Efectivo',&#10;    tarjeta: ' Tarjeta de Crédito/Débito',&#10;    transferencia: ' Transferencia Bancaria'&#10;};&#10;&#10;" />
              <option name="updatedContent" value="// ========== CONFIGURACIÓN ==========&#10;&#10;//  Detectar automáticamente la URL del servidor&#10;// Si se accede desde otro dispositivo, usa la IP del servidor&#10;// Si se accede localmente, usa localhost&#10;function getApiUrl() {&#10;    // Si estamos en el mismo servidor (localhost o 127.0.0.1)&#10;    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {&#10;        return 'http://localhost:7070/api';&#10;    }&#10;    // Si accedemos desde otro dispositivo, usa la IP del servidor&#10;    return `http://${window.location.hostname}:7070/api`;&#10;}&#10;&#10;export const CONFIG = {&#10;    API_URL: getApiUrl(),&#10;    POLLING: {&#10;        MAX_ATTEMPTS: 20,&#10;        INTERVAL_MS: 2000&#10;    },&#10;    ANIMATION: {&#10;        TYPING_SPEED_MS: 30,&#10;        DELAY_MS: 500&#10;    },&#10;    SIGNOS_VITALES: {&#10;        TEMPERATURA: { min: 35.5, max: 38.0 },&#10;        ALTURA: { min: 150, max: 190 },&#10;        RITMO: { min: 60, max: 100 },&#10;        PRESION_SYS: { min: 110, max: 130 },&#10;        PRESION_DIA: { min: 70, max: 90 }&#10;    }&#10;};&#10;&#10;export const ICONS = {&#10;    recepcion: '',&#10;    enfermero: '',&#10;    doctor: '‍⚕️',&#10;    completado: '✅',&#10;    error: '❌'&#10;};&#10;&#10;export const STEP_TITLES = {&#10;    recepcion: 'En Recepción',&#10;    enfermero: 'Con Enfermero',&#10;    doctor: 'Consulta Médica',&#10;    completado: 'Consulta Completada',&#10;    error: 'Error en el Proceso'&#10;};&#10;&#10;export const METODOS_PAGO = {&#10;    efectivo: ' Efectivo',&#10;    tarjeta: ' Tarjeta de Crédito/Débito',&#10;    transferencia: ' Transferencia Bancaria'&#10;};" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>